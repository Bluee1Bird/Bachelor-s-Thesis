\chapter{Summary and Conclusions}

This Thesis introduced HID spoofing and keyboard injection attacks, a type of cyber offensive that leverages the lack of authentication in USB protocols. During the enumeration phase of the USB protocol, a USB device can register as any kind of USB device, including a keyboard when it isn't. This is because it is necessary that HID easily connect to hosts since they may be the first and only way to communicate with a desktop computer. Leveraging this oversight malicious USB devices emerged. Early exploits built on impersonating auto-run features of CDs, but soon they developed into BadUSB, sticks, dongles, and modified keyboards; devices that incorporate microcontrollers to send HID traffic to a host. They are capable of spoofing keyboards and mice, remote control, transmitting data and much more to allow the attacker to gain full control. This vector was commercialised by Hak5 with the USB Rubber Ducky and later by Mischief Gadgets with the O.MG cable. Simultaneously, efforts were made to protect users against this evolving threat. Early attempts include White and Blacklisting devices. filtering of USB traffic, and incorporating users to decide about the trustworthiness of a device. Sandboxes evolved, systems that compared a user's expectations with actions by and information from the device, rate limiters were implemented, keystrokes were analyzed with machine learning, and side channels, such as vibrations, sound, and radio emissions were leveraged to detect spoofed keyboards. \\
In a next step, this thesis analyzed how to contribute to the existing publicly available attack payloads on the official O.MG GitHub by evaluating which subtechniques from the MITRE ATT\&CK framework were missing or underrepresented. It introduced the architecture for seven novel payloads, and further specified their implementations. Similarly, it analyzed USB traffic generated by an O.MG payload to find anomalies that could be used for O.MG detection. The anomalies that were found were then integrated into the architecture of a defence script. This script further features a rate limiter with two modes; Interarrival Time Analysis which measures the spacing of registered keystrokes and Time Window Analysis which detects artificially generated input by measuring keystrokes within a time window. This implementation was also described in detail and featured the dependencies to make it possible; Tshark and USBDeview. \\
Finally, the two implementations, the novel payloads and the defence script, were evaluated. The payloads were tested on three different devices to determine how well they achieved their goals. These same scripts were subsequently run against the developed defence, in three versions. The reliability of the Enumeration Analysis was tested separately from the Rate Limiter and vice versa. The best configurations for the rate limiters were ascertained based on how early they interrupted the novel payloads. It was determined that all three defence approaches were effective in detecting O.MG attacks and interrupting them before they could execute and cause harm to the host computer. \\

These evaluations were limited; the payloads were tested on three devices, the defence only on one. By their nature keyboard injection attacks and by extension the defences against them are highly dependent on the individual computers. The biggest factor for payloads is the unknown of a new device, even the same type of device running the same OS versions can have vast differences and hinder payloads from completing their goals. This variety is not represented with only three devices. Furthermore, tests were conducted heuristically, no statistical analysis was made, which means no general statement about the efficiency of the payloads can be made. Similar constraints apply to the defence script, which could only be tested on one device. The processing speed of the computer significantly influences the performance of both, the payloads and the defence script. Again, a large number and large variety of devices would be necessary to conduct a statistically relevant evaluation of effectiveness. The defence script has the additional constraint not dynamically determining the observed USB hub; devices with more than two hubs that don't use the USBPcap2 interface for the bulk of their processing have to manually adjust the script to find the correct hub for their specific build. 

Future work could focus on evaluating the effectiveness of the payloads and the defence script more broadly using multiple devices in various circumstances to defend against a bigger variety of payloads. This thesis did not cover all the gaps in the MITRE payloads by any means. Many more payloads can be developed and published to cover all possible subtechniques of the MITRE ATT\&CK framework. \\
A possible improvement on the defence script could be made by minimizing its delay. This can be achieved by more efficient frame analysis, possibly by using the Windows Raw Input API or by rewriting the script in a faster programming language, such as C or C\#.







